---
layout: null
---
<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="user-scalable=no, width=device-width, initial-scale=1.0, maximum-scale=1.0"/>
    <title>Sail Racing</title>
  </head>
  <style>
  body {
      font-size: 200%;
      background-color: black;
      color: #fcdb03;
      margin:0;
      padding:0;
      width: 100%;
      height: 100%;
  }
  .error {
      color: #F00;
  }
  </style>
  <body>
    <h1>Enable Javascript</h1>
  </body>
</html>
<script>
  function ctfmt() {
      var d = new Date();
      return d.toLocaleTimeString();
  }

  var v = 2;
  var c = null;
  var ct = ctfmt();

  var error = null;
  var errorcnt = 0;
  var tracking = null;
  var timer = null;
  
  const geolocationoptions = {
      maximumAge: 0,
      enableHighAccuracy: true,
      timeout: 1000
  };

  function elapsedsecond() {
      ct = ctfmt();
      if (errorcnt > 0) {
	  errorcnt = errorcnt - 1;
	  if (errorcnt == 0)
	      error = null;
      }
      drawpage();
  }

  function pos(p) {
      if (tracking == null)
	  return;
      c = p.coords;
  }

  function seterror(txt, sec) {
      if (sec == null) sec = 5;
      error = txt;
      errorcnt = sec;
  }

  function err(ec) {
      if (ec.code != GeolocationPositionError.TIMEOUT)
	  seterror(ec.message);
  }

  function updateposition() {
      navigator.geolocation.getCurrentPosition(pos, err, geolocationoptions);
  }

  function recordtoggle(startp) {
      if (tracking == null) {
	  timer = setInterval(elapsedsecond, 1000);
	  tracking = navigator.geolocation.watchPosition(pos, err, geolocationoptions);
      } else {
	  clearInterval(timer);
	  timer = null;
	  navigator.geolocation.clearWatch(tracking);
	  tracking = null;
	  c = null;
      }
      drawpage();
  }

  function drawpage() {
      var e = document.body;
      var h = ""
      if (tracking == null) {
	  h += '<p><a onclick="recordtoggle();">Start ' + v + '</a></p>';
      } else {
	  h += '<p><a onclick="recordtoggle();">Finish</a></p>';
      }
      if (c != null) {
	  h += '<p>Latitude, Longitude: ' + c.latitude + ', ' + c.longitude + ', ' + ct + '</p>';
      }
      if (error != null) {
	  h += '<p class="error">' + error + '</p>';
      }
      e.innerHTML = h
  }
  
  function getpermission() {
      navigator.permissions.query({
	  name: 'geolocation'
      }).then(function(result) {
	  if (result.state != 'granted')
	      seterror("This application requires geolocation permission to be set to granted.");
	  console.log('Permission: ' + result.state);
      });
  }

  if ("geolocation" in navigator && "permissions" in navigator) {
      getpermission()
      drawpage()
  } else {
      seterror("This application doesn't work in this browser");
      drawpage()
  }
</script>
